---
title: "Lab 3: Billboard Hot 100"
date: "Stat 331 </br> Solutions by Dr. Theobold"
output:
  prettydoc::html_pretty:
    theme: tactile
    highlight: github
    css: styles.css
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12,
                      fig.height=8, 
                      fig.path='Figs/',
                      warning=FALSE,
                      message=FALSE)

library(readr)
```


## The Data

Today, we will study song popularity.  In the US, the Billboard Hot 100 is a
list that comes out every week, showing the 100 most played songs that week.

The dataset can be downloaded 
[here](https://app.box.com/s/luiqkrrkds2q6l2xvppzwx5nejgpbgin). Note this
dataset was stored in a `txt` file, with *tabs* between the columns, so you will
need to use the `read_tsv()` function to read in the dataset. 

More information about the creation of this dataset, as well as some analyses by
the author, can be found here: [https://mikekling.com/analyzing-the-billboard-hot-100/](https://mikekling.com/analyzing-the-billboard-hot-100/)  
The dataset you are provided is a limited version of the full data, containing:

- `title`: The title
- `artist`: The artist
- `overall peak`: The highest rank the song ever reached (1 is the best)
- `weeks on chart`: The number of weeks the song was on the chart
- `chart date`: The latest date the song appeared on the Billboard Hot 100


```{r}
library(tidyverse)
library(lubridate)
```

```{r, echo = FALSE, eval = TRUE}
songs <- read_delim(here::here("5_strings-factors-dates",
                                "Lab-Billboard100",
                                "billboard_songs.txt"), 
                    delim = "\t", 
                    escape_double = FALSE
                    )
```

---

## Setup

Do any data cleaning you need.

*Hint:* You'll want to create a datetime object for the date the song leaves the
chart.

```{r}
songs <- songs %>% 
  mutate(
    date = as.character(`chart date`),
    year = str_sub(date, 0, 4),
    month = str_sub(date, 5, 6),
    day = str_sub(date, 7, 8),
    date = make_date(year =  year,
                     month = month,
                     day = day), 
    exit_date = date,
    entry_date = exit_date - weeks(`weeks on chart`)
  )

```

---

## Questions

__1. What 5 songs spent the longest on the charts?  Give only the title, artist, 
and weeks.__

```{r}
songs %>% 
  top_n(5, `weeks on chart`) %>%
  arrange(desc(`weeks on chart`)) %>%
  select(title, artist, `weeks on chart`)
```

</br>
</br>

__2. Which five artists had the most number 1 hits?__

*For this question, you may ignore songs with more than one artist listed.*

```{r}
songs %>% 
  filter(`overall peak` == 1) %>%
  group_by(artist) %>%
  summarize(num_songs = n()) %>%
  slice_max(num_songs, n = 5)

```

</br>
</br>

Use the team manager's birthday to answer the following question: 

__3. What hit songs could have been played at your 10th birthday party?  That
is, which songs that **eventually** peaked at #1  **entered** the charts within
two months (before or after) your 10th birthday?  Give only the song title,
artist, and date of chart entry.__


```{r}
my_bday <- mdy("January 14, 1989")
party_interval <- (my_bday + years(10) - months(2)) %--% 
  (my_bday + years(10) + months(2))

songs %>% 
  filter(`overall peak` == 1,
           entry_date %within% party_interval
         ) %>%
  select(title, artist, entry_date)
  
```

</br>
</br>

__4. Use `str_extract_all()` to uncover what is the
most common word, *at least* four letters long, used in the title of any song.
Give only the word itself, and its count.__


```{r}
title_words <- songs %>%
  pull(title) %>%
  str_extract_all("\\w+") %>%
  unlist() %>%
  str_to_lower()

my_words <- tibble(
  word = title_words,
  length = str_length(word)
)

my_words %>%
  filter(length >= 4) %>%
  count(word) %>%
  top_n(1, n)
```

</br>
</br>

__5. Let's take a look at artists who work together on songs. Which three 
artists have **featured** on the most Billboard charting songs?__  


```{r}
artist_creds <- songs %>%
  pull(artist)

feat_artists <- artist_creds %>% 
  str_subset("featuring") %>% 
  str_replace_all(".* featuring|feat|ft", "") %>%
  str_split("([&,])|( or )|( and )") %>%
  unlist() %>%
  str_trim(side = "both")
  
tibble(
  artist = feat_artists
) %>%
  count(artist) %>%
  slice_max(order_by = n, n = 3)

```

