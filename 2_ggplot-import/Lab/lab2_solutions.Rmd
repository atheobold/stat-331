---
title: "Lab 2: Exploring Rodents with ggplot2"
author: "Solutions by Dr. Theobold"
output: html_document 
---

```{r, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE)

library(tidyverse)
library(here)
```

# Data Context 

The Portal Project is a long-term ecological study being conducted near Portal,
AZ. Since 1977, the site has been used to study the interactions among rodents,
ants and plants and their respective responses to climate. To study the
interactions among organisms, we experimentally manipulate access to 24 study
plots. This study has produced over 100 scientific papers and is one of the
longest running ecological studies in the U.S.

We will be investigating the animal species diversity and weights found within
plots at the Portal study site. The dataset is stored as a comma separated value (CSV) file. Each row holds information for a single animal, and the columns represent:

| Column           | Description                        |
|------------------|------------------------------------|
| record\_id       | Unique id for the observation      |
| month            | month of observation               |
| day              | day of observation                 |
| year             | year of observation                |
| plot\_id         | ID of a particular plot            |
| species\_id      | 2-letter code                      |
| sex              | sex of animal ("M", "F")           |
| hindfoot\_length | length of the hindfoot in mm       |
| weight           | weight of the animal in grams      |
| genus            | genus of animal                    |
| species          | species of animal                  |
| taxon            | e.g. Rodent, Reptile, Bird, Rabbit |
| plot\_type       | type of plot                       |


# Reading the Data into R

We have seen in the practice activity that when importing a data 
frame, the columns that contain characters (i.e., text) are coerced 
(=converted) into the `factor` data type. We had to set **`stringsAsFactors`** 
to **`FALSE`** to avoid this hidden argument to convert our data type. 

For this lab we will use the **`readr`** package (from the `tidyverse`) to
read in the data and avoid having to set **`stringsAsFactors`** to **`FALSE`**

We'll read in our data using the `read_csv()` function instead of the 
`read.csv()` function. 

__1. Using the `read_csv()` function and the **here** package, to write the code necessary to load in the `surveys.csv` dataset.__

```{r, results = 'hide'}
surveys <- read_csv(here("2_ggplot-import", "Lab", "surveys.csv"))
## NOTE: This path is unique to MY project and your path may look different!
## The important part is that you use the here() function to specify your path
```

__2. What are the dimensions of these data?__

There are 30,463 rows (observations) and 15 columns (variables) in the dataset. 

```{r}
dim(surveys)
```


__3. What types of variables are included in the dataset?__ 

There are a mix of numeric, character, and date variables. All of the
qualitative / categorical variables about each animal (`species_id`, `sex`,
`genus`) are all character data types. Some of the numeric data are fairly 
continuous (e.g., `hindfoot_length`), while others are more discrete 
(e.g., `month`). There is the possibility that discrete numerical variables 
should be considered to be categorical rather than continuous. 

```{r}
glimpse(surveys)
```


## Plotting with **`ggplot2`**

`ggplot()` graphics are built step by step by adding new elements. Adding layers 
in this fashion allows for extensive flexibility and customization of plots.

To build a `ggplot()`, we will use the following basic template that can be used 
for different types of plots:

`ggplot(data = <DATA>, mapping = aes(<VARIABLE MAPPINGS>)) +  <GEOM_FUNCTION>()`

Let's get started!  

## Scatterplot

__4. First, let's create a scatterplot of the relationship between `weight` (on the x-axis) and `hindfoot_length` (on the y-axis).__ 


```{r}
ggplot(data = surveys,
       mapping = aes(x = weight, y = hindfoot_length)) +
    geom_point()
```

We can see there are **a lot** of points plotted on top of each other. Let's try
and modify this plot to extract more information from it. 

__5. Let's add transparency (`alpha`) to the points, to make the points more transparent and (possibly) easier to see.__ 

```{r, results = 'hold'}
ggplot(data = surveys, 
       mapping = aes(x = weight, y = hindfoot_length)) +
    geom_point(alpha = 0.1)
## alpha reduces the opacity of the points 
## 0 is fully transparent
## 1 is the original opacity
```

Well, that is better, but there are still large clumps of data being plotted on
top of each other. Let's try another tool! 

__6. Add some jitter to the points in the scatterplot, using `geom_jitter()`.__

```{r, results = 'hold'}
ggplot(data = surveys, 
       mapping = aes(x = weight, y = hindfoot_length)) +
    geom_jitter(alpha = 0.1)
```

## Faceting

Despite our best efforts there is still a substantial amount of overplotting 
occurring in our scatterplot. Let's try splitting the dataset into smaller 
subsets and see if that allows for us to see the trends a bit better. 

__7. Facet your jittered scatterplot by `species_id`.__

```{r, results = 'hold'}
ggplot(data = surveys, 
       mapping = aes(x = weight, y = hindfoot_length)) +
  geom_jitter(alpha = 0.1) + 
  facet_wrap(~ species_id)
```


# Boxplots & Density Ridges

__8. Create side-by-side boxplots to visualize the distribution of weight within each species.__

```{r}
ggplot(data = surveys, 
       mapping = aes(x = species, y = weight)) +
    geom_boxplot()
```

By adding points to boxplot, we can have a better idea of how many observations
fall into each genus: 

```{r, results = 'hold'}
surveys %>% 
  ggplot(mapping = aes(x = species, y = weight)) +
    geom_jitter(alpha = 0.2, color = "tomato") + 
    geom_boxplot(outlier.shape = NA, alpha = 0.2)  
    # You could also use outlier.alpha = 0
```

But there is a problem! You should notice that there are **both** red points 
and black points. So, some of the observations are being plotted twice! 

__9. Inspect the help file for `geom_boxplot()` and see how you can remove the outliers from being plotted by `geom_boxplot()`. Make this change in the code above!__


# Customization

I've outlined some small changes that make **big** differences to plots. One of 
these changes are better labels for a plot's axes and legend. 

__10. Using the code you created in question 9, modify the x-axis and y-axis labels.__

```{r}
surveys %>% 
  ggplot(mapping = aes(x = species, y = weight)) +
    geom_jitter(alpha = 0.1, color = "tomato") + 
    geom_boxplot(outlier.shape = NA, alpha = 0.2) +
    labs(y = "Weight (in grams)",
         x = "Species of Rodent") 
```

Some people (and journals) prefer for boxplots to be stacked with a specific 
orientation! Previously to flip your boxplots from horizontal to vertical 
stacking you would need to use the `coord_flip()` function. **But** the most
recent update to ggplot2 makes it possible to flip coordinates without an extra
function. 

__11. Flip the orientation of the boxplots you created in question 9. If you created side-by-side boxplots (stacked horizontally), your boxplots should be stacked vertically. If you had vertically stacked boxplots, you should stack your boxplots horizontally!__ 

```{r}
surveys %>% 
  ggplot(mapping = aes(y = species, x = weight)) +
    geom_jitter(alpha = 0.1, color = "tomato") + 
    geom_boxplot(outlier.shape = NA, alpha = 0.5) + 
    labs(x = "Weight (in grams)",
         y = "Species of Rodent") 
```
