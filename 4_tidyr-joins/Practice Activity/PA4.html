<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.120">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Practice Activity 4: Tidy Data with tidyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="PA4_files/libs/clipboard/clipboard.min.js"></script>
<script src="PA4_files/libs/quarto-html/quarto.js"></script>
<script src="PA4_files/libs/quarto-html/popper.min.js"></script>
<script src="PA4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="PA4_files/libs/quarto-html/anchor.min.js"></script>
<link href="PA4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PA4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="PA4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="PA4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="PA4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practice Activity 4: Tidy Data with tidyr</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Today you will be tidying untidy data to explore the relationship between countries of the world and military spending.</p>
<section id="some-reminders-as-you-work" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="some-reminders-as-you-work"><span class="header-section-number">1</span> Some Reminders as You Work</h2>
<p><strong>Two heads are better than one</strong></p>
<p>It can be hard to spot bugs in code that you wrote.</p>
<p>Work with those around you - if something goes wrong, ask a friend or team member to take a peek at your code and see if any glaring errors (like <em>syntax error</em>) pop out.</p>
<p><strong>Explain your code out loud</strong></p>
<p>The best way to troubleshoot a sneaky but is to explain out loud each step of your code, and what you hoped to accomplish.</p>
<p>Schedule a meeting with your team to have everyone talk through their code.</p>
<p>If you are alone, try <a href="https://en.wikipedia.org/wiki/Rubber_duck_debugging">Rubber Duck Debugging</a>!</p>
<p><strong>Google is your friend</strong></p>
<p>The whole of the internet is at your disposal! Use it early, use it often.</p>
<p>Some tricks:</p>
<ul>
<li><p>Copy-paste the exact error message into Google. Chances are, somebody else had a similar problem and got a similar message.</p></li>
<li><p>Include package names in your search terms. For example, “long data in tidyr” is a better search than “long data in R”.</p></li>
</ul>
</section>
<section id="data-for-todays-activity" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="data-for-todays-activity"><span class="header-section-number">2</span> Data for Today’s Activity</h2>
<p>The SIPRI (Stockholm International Peace Research Institute) Military Expenditure Database is an open source dataset with contains consistent time series on the military spending of countries for the period 1949–2018. The database is updated annually, which may include updates to data for any of the years included in the database.</p>
<p>Military expenditure in local currency at current prices is presented according to both the financial year of each country and according to calendar year, calculated on the assumption that, where financial years do not correspond to calendar years, spending is distributed evenly through the year. Figures in constant (2017) and current US $, as a share of GDP and per capita are presented according to calendar year.</p>
<p>The availability of data varies considerably by country, but for a majority of countries that were independent at the time, data is available from at least the late 1950s. Estimates for regional military expenditure have been extended backwards depending on availability of data for countries in the region, but no estimates for total world military expenditure are available before 1988 due to the lack of data for the Soviet Union.</p>
<p>SIPRI military expenditure data is based on open sources only.</p>
</section>
<section id="data-inspection" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="data-inspection"><span class="header-section-number">3</span> Data Inspection</h2>
<p><strong>Download the data on Canvas. Open the Excel file and inspect the file.</strong></p>
<p>First, you should notice that there are ten different sheets included in the dataset. We are interested in the sheet labeled “Share of Govt. spending” which contains information about the share of government spending that is allocated to military spending.</p>
<p>Next, you’ll notice that there are notes about the dataset in the first six rows. Ugh! Also notice that the last six rows are footnotes about the dataset. <strong>Ugh</strong>!</p>
<p>Rather than copying this one sheet into a new Excel file and deleting the first and last six rows, let’s learn something new about the <code>read_xlsx()</code> function!</p>
</section>
<section id="data-import" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="data-import"><span class="header-section-number">4</span> Data Import</h2>
<p>The <code>read_xlsx()</code> function has a <code>sheet</code> argument, where you specify the name of the sheet that you want to use.</p>
<p><strong>Note:</strong> The name must be passed in as a string (in quotations)!</p>
<p>The <code>read_xlsx()</code> function also has a <code>skip</code> argument, where you specify the number of rows you want to be skipped <em>before</em> reading in the data.</p>
<p>Finally, <code>read_xlsx()</code> also has a <code>n_max</code> argument, where you specify the maximum number of rows of data to read in.</p>
<p><strong>1.</strong> Modify the code below to read the military expenditures data into your work space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>military <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"gov_spending_per_capita.xlsx"</span>), </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet =</span> , </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">skip =</span> , </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nmax =</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-cleaning" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="data-cleaning"><span class="header-section-number">5</span> Data Cleaning</h2>
<p>In addition to <code>NA</code>s, missing or unavailable values were coded two ways.</p>
<p><strong>2.</strong> Find these two methods and write the code to replace these values with NAs. Save the mutated dataset into a new object named <code>military_clean</code>.</p>
<p>Because of the use of characters to mark missing values, all of the columns 1988 through 2019 were read in a characters.</p>
<p><strong>3.</strong> Mutate these columns to all be numeric data types, instead of a character data type. Save these changes into an updated version of <code>military_clean</code>.</p>
<p>If you give the <code>Country</code> column a look, you’ll see that there are names of continents <strong>and</strong> regions included. These names are only included to make it simpler to find countries, as they contain no data.</p>
<p>Luckily for us, these region names were also stored in the “Regional totals” sheet. We can us the <code>Region</code> column of this dataset to filter out the names we don’t want.</p>
<p>Run the code below to read in the “Regional totals” dataset, making any necessary modifications to the path.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>cont_region <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"gov_spending_per_capita.xlsx"</span>), </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">"Regional totals"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">skip =</span> <span class="dv">14</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">!=</span> <span class="st">"World total (including Iraq)"</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>         Region <span class="sc">!=</span> <span class="st">"World total (excluding Iraq)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you think about <code>filter()</code>ing data, so that only certain values of a variable are retained, we should remember our friendly <code>%in%</code> function! However, if you think about the code below, you should notice that this code retains only the values we wanted to remove!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>military_clean <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">%in%</span> cont_region<span class="sc">$</span>Region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unfortunately, R doesn’t come with a built-in <code>!%in%</code> function. However, a clever way to filter out observations you don’t want is with a join. A tool tailored just for this scenario is the <code>anti_join()</code> function. This function will return all of the rows of one dataset <strong>without</strong> a match in another dataset.</p>
<p><strong>4.</strong> Use the <code>anti_join()</code> function to filter out the <code>Country</code> values we don’t want in the <code>military_clean</code> dataset. The <code>by</code> argument needs to be filled with the name(s) of the variables that the two datasets should be joined with.</p>
<p><strong>Hint:</strong> To join by different variables on <code>x</code> and <code>y</code>, use a named vector. For example, <code>by = c("a" = "b")</code> will match <code>x$a</code> to <code>y$b</code>.</p>
<section id="part-one-answer" class="level3">
<h3 class="anchored" data-anchor-id="part-one-answer">Part One Answer</h3>
<p>What regions were not removed from the <code>military_clean</code> dataset? Use their correct capitalization <strong>and</strong> punctuation!</p>
</section>
</section>
<section id="data-organization" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="data-organization"><span class="header-section-number">6</span> Data Organization</h2>
<p>The comparison I am interested in looking at the military expenditures across every year in the data. Something like this:</p>
<p><a href="https://app.box.com/embed/s/ed74ynmti87pk8oats4jdbhwb5rqf7cm?sortColumn=date&amp;view=list" class="uri">https://app.box.com/embed/s/ed74ynmti87pk8oats4jdbhwb5rqf7cm?sortColumn=date&amp;view=list</a></p>
<p>Unfortunately, this requires that every year is included in one column!</p>
<p>To tidy a dataset like this, we need to pivot the columns of years from wide format to long format. To do this process we need three parameters:</p>
<ul>
<li><p>The set of columns that represent values, not variables. In these data, those are all the columns from <code>1988</code> to <code>2018</code>.</p></li>
<li><p>The name of the variable that should be created to move these columns into. In these data, this could be <code>"Year"</code>.</p></li>
<li><p>The name of the variable that should be created to move these column’s values into. In these data, this could be labeled <code>"Spending"</code>.</p></li>
</ul>
<p>Each of these pieces form the three required arguments to the <code>pivot_longer()</code> function.</p>
<p><strong>4.</strong> Pivot the cleaned up <code>military</code> dataset to a “longer” orientation. Save this new “long” version as a new dataset (<strong>do not</strong> overwrite your cleaned up dataset)!</p>
</section>
<section id="data-visualization-exploration" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="data-visualization-exploration"><span class="header-section-number">7</span> Data Visualization Exploration</h2>
<p>Now that we’ve transformed the data, let’s create a plot to explore the military spending across the years.</p>
<p><strong>5.</strong> Create side-by-side boxplots of the military spending for each year.</p>
<p><strong>Hint:</strong> Place the <code>Year</code> variable on an axis that makes it easier to read the labels!</p>
<section id="part-two-answer" class="level3">
<h3 class="anchored" data-anchor-id="part-two-answer">Part Two Answer</h3>
<p>What year was the second largest military expenditure? What country had this expenditure?</p>
<p><strong>Bonus</strong>: What is the reason for this large expenditure?</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>