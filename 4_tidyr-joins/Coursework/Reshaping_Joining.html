<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Reshaping and Joining Data Frames</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="reshaping_joining_files/libs/clipboard/clipboard.min.js"></script>
<script src="reshaping_joining_files/libs/quarto-html/quarto.js"></script>
<script src="reshaping_joining_files/libs/quarto-html/popper.min.js"></script>
<script src="reshaping_joining_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="reshaping_joining_files/libs/quarto-html/anchor.min.js"></script>
<link href="reshaping_joining_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="reshaping_joining_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="reshaping_joining_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="reshaping_joining_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="reshaping_joining_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Reshaping and Joining Data Frames</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>In this lesson, you will learn:</p>
<ul>
<li><p>The importance of nicely formatted code and how to adhere to style ‚Äúguidelines‚Äù</p></li>
<li><p>How to <strong>reshape</strong> your dataset by pivoting <em>longer</em> or <em>wider</em></p></li>
<li><p>How to use <strong>mutating joins</strong> and <strong>filtering joins</strong> to combine different datasets with related information.</p></li>
</ul>
<hr>
<p>‚ñ∂Ô∏è Watch Videos: 25 minutes</p>
<p>üìñ Readings: 30-60 minutes</p>
<p>üíª Activities: 45-60 minutes</p>
<p>‚úÖ Check-ins: 2</p>
<hr>
<section id="code-style" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Code Style</h1>
<p>‚úÖ <strong>Check-in: <em>Code Style</em></strong></p>
<p>You‚Äôve been spending time and getting feedback on the formatting of your code. Based on what you‚Äôve read, address the following questions.</p>
<p><strong>Question 1:</strong> Based on the tidyverse style guide, where should whitespace (blank spaces) go?</p>
<ul>
<li><p>Before and after every <code>+</code> sign</p></li>
<li><p>Before and after every <code>%&gt;%</code></p></li>
<li><p>Before and after every athematic operator (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>)</p></li>
<li><p>After every comma</p></li>
<li><p>Before every comma</p></li>
</ul>
<p><strong>Question 2:</strong> How many characters per line should you strive to have in your R code (and RMarkdown files)?</p>
<div class="columns">
<div class="column" style="width:40%;">
<p><strong>Question 3:</strong> Based on the styleguide, which of the following are <strong>bad</strong> object names?</p>
<ul>
<li><p><code>data</code></p></li>
<li><p><code>cereals_data</code></p></li>
<li><p><code>cereals.data</code></p></li>
<li><p><code>cerealsData</code></p></li>
<li><p><code>cerealsdata</code></p></li>
<li><p><code>cereals_data1</code></p></li>
<li><p><code>cereals_data_clean</code></p></li>
</ul>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:55%;">
<p><img src="images/different_cases_horst.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
<section id="reshaping-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Reshaping Data</h1>
<hr>
<section id="tidy-data-and-reshaping" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="tidy-data-and-reshaping"><span class="header-section-number">2.1</span> Tidy Data and Reshaping</h2>
<p>üìñ <a href="https://r4ds.had.co.nz/tidy-data.html">Required Reading: <em>R4DS</em> 12.1-12.3 (Tidy Data)</a></p>
<p>‚ñ∂Ô∏è <a href="http://somup.com/crfFrmF6VQ">Required Video: Data Layouts ‚Äì 7 minutes</a></p>
<p>‚ñ∂Ô∏è <a href="http://somup.com/crfF3NF6hg">Required Video: Pivoting Longer ‚Äì 9 minutes</a></p>
<p>‚ñ∂Ô∏è <a href="http://somup.com/crfqebF63k">Required Video: Pivoting Wider ‚Äì 9 minutes</a></p>
<p>üìñ <a href="https://r4ds.had.co.nz/tidy-data.html">Optional Reading: <em>R4DS</em> 12.4-12.5 (Separate / Unite and Missing Values)</a> ‚Äì A few more tricks for data cleaning / wrangling, if you‚Äôre interested!</p>
<hr>
<p>‚úÖ <strong>Check-in: <em>Pivoting</em></strong></p>
<ul>
<li>Download the <code>cereal.csv</code> data here: <a href="https://app.box.com/s/zcr1fijnwxs27nvtxn4p38p3sgtxl4bt" class="uri">https://app.box.com/s/zcr1fijnwxs27nvtxn4p38p3sgtxl4bt</a></li>
</ul>
<p><strong>Question 1:</strong> Create a new dataset called <code>cereals_long</code>, that has three columns:</p>
<ul>
<li><p>The <code>name</code> of the cereal</p></li>
<li><p>A column called <code>Nutrient</code> with values <code>"protein"</code>, <code>"fat"</code>, or <code>"fiber"</code>.</p></li>
<li><p>A column called <code>Amount</code> with the corresponding amount of the nutrient.</p></li>
</ul>
<hr>
</section>
</section>
<section id="joining-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Joining data</h1>
<hr>
<p>üìñ <a href="https://r4ds.had.co.nz/relational-data.html">Required Reading: <em>R4DS</em> Chapter 13 (Relational Data)</a></p>
<p>üìñ <a href="https://www.garrickadenbuie.com/project/tidyexplain/">Required Reading: Mutating Joins</a></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note: We <strong>will not</strong> be using <code>spread()</code> and <code>gather()</code> in this course, as they are deprecated functions!</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Because these chapters do a <strong>much</strong> better job visualizing the concepts, I‚Äôve chosen not to record additional videos.</p>
</div>
</div>
<hr>
<p>‚úÖ <strong>Check-in: <em>Practice with Joins</em></strong></p>
<p>The following code creates three datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>prof_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">professor =</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Bodwin"</span>, <span class="st">"Glanz"</span>, <span class="st">"Carlton"</span>, <span class="st">"Sun"</span>, <span class="st">"Theobold"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">undergrad_school =</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Harvard"</span>, <span class="st">"Cal Poly"</span>, <span class="st">"Berkeley"</span>, <span class="st">"Harvard"</span>, <span class="st">"Colorado Mesa University"</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">grad_school =</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"UNC"</span>, <span class="st">"Boston University"</span>, <span class="st">"UCLA"</span>, <span class="st">"Stanford"</span>, <span class="st">"Montana State University"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>prof_course <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">professor =</span> <span class="fu">c</span>(<span class="st">"Bodwin"</span>, <span class="st">"Glanz"</span>, <span class="st">"Carlton"</span>, <span class="st">"Theobold"</span>),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Stat_331 =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Stat_330 =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Stat_431 =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>course_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">course =</span> <span class="fu">c</span>(<span class="st">"Stat_331"</span>, <span class="st">"Stat_330"</span>, <span class="st">"Stat_431"</span>),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_sections =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is what they look like once created:</p>
<p><code>prof_info</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>prof_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  professor         undergrad_school              grad_school
1    Bodwin                  Harvard                      UNC
2     Glanz                 Cal Poly        Boston University
3   Carlton                 Berkeley                     UCLA
4       Sun                  Harvard                 Stanford
5  Theobold Colorado Mesa University Montana State University</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>prof_course </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  professor Stat_331 Stat_330 Stat_431
1    Bodwin     TRUE    FALSE     TRUE
2     Glanz     TRUE     TRUE     TRUE
3   Carlton     TRUE     TRUE    FALSE
4  Theobold     TRUE    FALSE     TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>course_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    course num_sections
1 Stat_331            8
2 Stat_330            3
3 Stat_431            1</code></pre>
</div>
</div>
<p>These datasets contain information about five Cal Poly professors, their educational history, the classes they are able to teach, and the number of sections of each class that need to be assigned.</p>
<p><strong>a) Combine datasets 1 and 2 to make this dataset:</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  professor         undergrad_school              grad_school Stat_331 Stat_330
1    Bodwin                  Harvard                      UNC     TRUE    FALSE
2     Glanz                 Cal Poly        Boston University     TRUE     TRUE
3   Carlton                 Berkeley                     UCLA     TRUE     TRUE
4  Theobold Colorado Mesa University Montana State University     TRUE    FALSE
  Stat_431
1     TRUE
2     TRUE
3    FALSE
4     TRUE</code></pre>
</div>
</div>
<p><strong>b) Combine datasets 1 and 2 to make this dataset:</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  professor         undergrad_school              grad_school Stat_331 Stat_330
1    Bodwin                  Harvard                      UNC     TRUE    FALSE
2     Glanz                 Cal Poly        Boston University     TRUE     TRUE
3   Carlton                 Berkeley                     UCLA     TRUE     TRUE
4       Sun                  Harvard                 Stanford       NA       NA
5  Theobold Colorado Mesa University Montana State University     TRUE    FALSE
  Stat_431
1     TRUE
2     TRUE
3    FALSE
4       NA
5     TRUE</code></pre>
</div>
</div>
<p><strong>c) Combine datasets 2 and 3 to make this dataset:</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 √ó 4
   professor course   can_teach num_sections
   &lt;chr&gt;     &lt;chr&gt;    &lt;lgl&gt;            &lt;dbl&gt;
 1 Bodwin    Stat_331 TRUE                 8
 2 Bodwin    Stat_330 FALSE                3
 3 Bodwin    Stat_431 TRUE                 1
 4 Glanz     Stat_331 TRUE                 8
 5 Glanz     Stat_330 TRUE                 3
 6 Glanz     Stat_431 TRUE                 1
 7 Carlton   Stat_331 TRUE                 8
 8 Carlton   Stat_330 TRUE                 3
 9 Carlton   Stat_431 FALSE                1
10 Theobold  Stat_331 TRUE                 8
11 Theobold  Stat_330 FALSE                3
12 Theobold  Stat_431 TRUE                 1</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>