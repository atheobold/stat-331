---
title: "Reshaping and Joining Data Frames"
format: 
  html: 
    theme: minty
    fontsize: 1em
    mainfont: sans-serif
    number-sections: true
    number-depth: 2
    code-block-bg: "#76b5c5"
    highlight-style: monochrome
    self-contained: true
    table-of-contents: true
editor: visual
execute: 
  echo: true
resources: 
  - Slides/cereal.csv
---

```{r}
#| include: false
library(tidyverse)
```

In this lesson, you will learn:

-   The importance of nicely formatted code and how to adhere to style
"guidelines"

-   How to **reshape** your dataset by pivoting *longer* or *wider*

-   How to use **mutating joins** and **filtering joins** to combine different
datasets with related information.

------------------------------------------------------------------------

`r emo::ji("play button")` Watch Videos: 25 minutes

`r emo::ji("book")` Readings: 30-60 minutes

`r emo::ji("computer")` Activities: 45-60 minutes

`r emo::ji("check")` Check-ins: 3

------------------------------------------------------------------------

# Code Style

`r emo::ji("check")` **Check-in: *Code Style***

You've been spending time and getting feedback on the formatting of your code. Based on what you've read, address the following questions.

**Question 1:** Based on the [tidyverse style guide](https://style.tidyverse.org/), where should whitespace (blank spaces) go?

-   Before and after every `+` sign

-   Before and after every `%>%`

-   Before and after every athematic operator (`+`, `-`, `*`, `/`)

-   After every comma

-   Before every comma

**Question 2:** How many characters per line should you strive to have in your R code (and RMarkdown files)?

::: columns
::: {.column width="40%"}
**Question 3:** Based on the styleguide, which of the following are **bad** object names?

-   `data`

-   `cereals_data`

-   `cereals.data`

-   `cerealsData`

-   `cerealsdata`

-   `cereals_data1`

-   `cereals_data_clean`
:::

::: {.column width="5%"}
:::

::: {.column width="55%"}
![](images/different_cases_horst.png)
:::
:::

# Reshaping Data

## Tidy Data and Reshaping

::: {.column-margin}
![](images/05-tidyr.png)
:::

`r emo::ji("book")` [Required Reading: *R4DS* Chapter 6 (Data tidying)](https://r4ds.hadley.nz/data-tidy.html)

`r emo::ji("play button")` [Required Video: Data Layouts -- 7 minutes](http://somup.com/crfFrmF6VQ)

`r emo::ji("play button")` [Required Video: Pivoting Longer -- 9 minutes](http://somup.com/crfF3NF6hg)

`r emo::ji("play button")` [Required Video: Pivoting Wider -- 9 minutes](http://somup.com/crfqebF63k)

### `r emo::ji("check")` **Check-in 4.1: *Pivoting***

Download the [`cereal.csv` data here](Slides/cereal.csv). 

**Question 1:** Create a new dataset called `cereals_long`, that has three columns:

-   The `name` of the cereal

-   A column called `Nutrient` with values `"protein"`, `"fat"`, or `"fiber"`.

-   A column called `Amount` with the corresponding amount of the nutrient.

# Joining data

`r emo::ji("book")` [Required Reading: *R4DS* Chapter 21 (Joins)](https://r4ds.hadley.nz/joins.html)

::: callout-note
Because these chapters do a **much** better job visualizing the concepts, I've chosen not to record additional videos.
:::

### `r emo::ji("check")` **Check-in: *Practice with Joins***

The following code creates three datasets / tibbles:

```{r}
prof_info <- tibble(
  professor = c("Bodwin", 
                "Glanz", 
                "Robinson",
                "Theobold"),
  undergrad_school = c("Harvard", 
                       "Cal Poly",
                       "Winona State University",
                       "Colorado Mesa University"),
  grad_school = c("UNC", 
                  "Boston University", 
                  "University of Nebraska-Lincoln",
                  "Montana State University")
)

prof_course <- tibble(
  professor = c("Bodwin", "Robinson", "Theobold", "Carlton"),
  Stat_331 = c(TRUE, TRUE, TRUE, TRUE),
  Stat_330 = c(FALSE, TRUE, FALSE, FALSE),
  Stat_431 = c(TRUE, TRUE, TRUE, FALSE)
)

course_info <- data.frame(
  course = c("Stat_331", "Stat_330", "Stat_431"),
  num_sections = c(8, 3, 1)
)

```

Here is what they look like once created:

`prof_info`

```{r prof-info}

prof_info

prof_course 

course_info
```

These datasets contain information about five Cal Poly professors, their educational history, the classes they are able to teach, and the number of sections of each class that need to be assigned.

**a) Combine datasets 1 and 2 to make this dataset:**

```
  professor undergrad_school         grad_school                    Stat_331 Stat_330 Stat_431
  <chr>     <chr>                    <chr>                          <lgl>    <lgl>    <lgl>   
1 Bodwin    Harvard                  UNC                            TRUE     FALSE    TRUE    
2 Robinson  Winona State University  University of Nebraska-Lincoln TRUE     TRUE     TRUE    
3 Theobold  Colorado Mesa University Montana State University       TRUE     FALSE    TRUE   
```

**b) Combine datasets 1 and 2 to make this dataset:**

```
  professor Stat_331 Stat_330 Stat_431 undergrad_school         grad_school                   
  <chr>     <lgl>    <lgl>    <lgl>    <chr>                    <chr>                         
1 Bodwin    TRUE     FALSE    TRUE     Harvard                  UNC                           
2 Robinson  TRUE     TRUE     TRUE     Winona State University  University of Nebraska-Lincoln
3 Theobold  TRUE     FALSE    TRUE     Colorado Mesa University Montana State University      
4 Carlton   TRUE     FALSE    FALSE    NA                       NA      
```

**c) Combine datasets 2 and 3 to make this dataset:**

```
   professor course   can_teach num_sections
   <chr>     <chr>    <lgl>            <dbl>
 1 Bodwin    Stat_331 TRUE                 8
 2 Bodwin    Stat_330 FALSE                3
 3 Bodwin    Stat_431 TRUE                 1
 4 Robinson  Stat_331 TRUE                 8
 5 Robinson  Stat_330 TRUE                 3
 6 Robinson  Stat_431 TRUE                 1
 7 Theobold  Stat_331 TRUE                 8
 8 Theobold  Stat_330 FALSE                3
 9 Theobold  Stat_431 TRUE                 1
10 Carlton   Stat_331 TRUE                 8
11 Carlton   Stat_330 FALSE                3
12 Carlton   Stat_431 FALSE                1
```