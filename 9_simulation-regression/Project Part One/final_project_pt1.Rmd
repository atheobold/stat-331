---
title: "Final Project: Part One"
output: rmdformats::readthedown
---

```{r, include = FALSE}
library(tidyverse)

knitr::opts_chunk$set(cache = TRUE)

education <- read_csv(here::here("9_simulation-regression",
                               "Project Part One",
                                "ratio_of_girls_to_boys_in_primary_and_secondary_education_perc.csv")
                    )

income <- read_csv(here::here("9_simulation-regression",
                               "Project Part One",
                              "income_per_person_gdppercapita_ppp_inflation_adjusted.csv")
)
```


In Part One of this project you will:

- Find two **quantitative** variables from Gapmider that you are interested in
exploring their relationship
- Download the data files for each variable
- Join two datasets into one larger dataset
- Visualize the relationship between these variables
- Use linear regression to model the relationship between these variables
- Describe the fit of the regression model


# The Data 

The data for this project were pulled from the 

<https://www.gapminder.org/data/>


# Data Cleaning 

It is often said that 80-90% of what a "data scientist" does is clean and 
organize data, in preparation for an analysis. I have certainly found this to 
be true.  

The variables you choose will each be contained in a spreadsheet. The 
spreadsheet will look something like this:

```{r, echo = FALSE}
education
```

## Pivoting Longer

You should notice that the values of `year` are spread across multiple columns.
For your analysis, you will need to pivot these columns to be in a **single**
column. 

```{r, include = FALSE}

k_to_thousands <- function(x){
  
  num <- case_when(str_detect(x, pattern = "k") ~ 
                     as.numeric(
                       str_extract(x, pattern = ".*[^k]") 
                       ) * 1000, 
                   TRUE ~ as.numeric(x)
  )
  return(num)
}

education_long <- education %>% 
  pivot_longer(cols = -country, 
               names_to = "year", 
               values_to = "ratio_boys_to_girls")

income_long <- income %>% 
  mutate(across(.cols = -country, 
                .fns = k_to_thousands
                )
         ) %>% 
  pivot_longer(cols = -country, 
               names_to = "year", 
               values_to = "gdp_per_person")
```

## Data Cleaning

It is possible that you will need to perform some data cleaning *before* 
pivoting! For example, if some incomes are recorded as `36` while others are 
recorded as `"1.1k"`, R will not allow for you to pivot your columns since
these columns do not have the same data type! You will need to convert the 
value of `"1.1k"` into a number *before* pivoting. 

## Joining Datasets

To have both of the variables in the **same** dataset, you will need to perform
a join. The type of join is up to you, but keep in mind that the default in 
`ggplot()` and in `lm()` is to drop all of the `NA` values before plotting or 
fitting a regression model. 

```{r, include = FALSE}

ed_income <- education_long %>% 
  left_join(income_long, 
            by = c("year", "country")
  )
```


---

# Data Visualization

Create **two** visualizations exploring the following:

1. The relationship between the two quantitative variables you are investigating

*Keep in mind your response should be on the y-axis and your explanatory
variable should be on the x-axis.* 

2. How this relationship (from #1) has changed over time

# Linear Regression

Fit a simple linear regression model for the relationship between the variables
you selected. Similar to your visualization, you will need to define which
variable is the response ($y$) and which variable is the explanatory ($x$).

Your final report should present the estimated regression model _and_ provide
an interpretation for each of the coefficients output.


## Model Fit

To assess how "good" of a regression model you have we are going to look at how
much of the variability in the response values were accounted for by your
regression. 

The goal of regression is to account for as much variability in the response
values as we can. Here, the variance in the fitted values represents the 
amount of variability in the response that was accounted for by the explanatory
variable. The variance in the residuals represents the amount of variability 
in the responses that **has not** been accounted for. 

Make a nicely formatted table that presents the following:

- The variance in the response values
- The variance in the fitted values from your regression model
- The variance in the residuals from your regression model

Discuss the proportion of the variability in the response values that was 
accounted for by your regression model. What does this suggest about the 
"quality" of your model?

*Note: We are skirting around the ideas of $R^2$, which you can read more 
about [here](https://moderndive.com/6-multiple-regression.html#rsquared).*
