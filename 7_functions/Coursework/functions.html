<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Writing User-Defined Functions in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="functions_files/libs/clipboard/clipboard.min.js"></script>
<script src="functions_files/libs/quarto-html/quarto.js"></script>
<script src="functions_files/libs/quarto-html/popper.min.js"></script>
<script src="functions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="functions_files/libs/quarto-html/anchor.min.js"></script>
<link href="functions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="functions_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="functions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="functions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="functions_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Writing User-Defined Functions in R</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>This week you will learn to:</p>
<ul>
<li><p>Write your own functions in R</p></li>
<li><p>Make good decisions about function arguments and returns</p></li>
<li><p>Include side effects and / or error messages in your functions</p></li>
<li><p>Extend your use of good R coding style</p></li>
</ul>
<hr>
<p>‚ñ∂Ô∏è Watch Videos: 22 minutes</p>
<ul>
<li>üîó Link to <strong>all</strong> Slides from Videos: <a href="https://app.box.com/s/bctcjsbysmpv0vs84izzeqk09sx7mz00">here</a></li>
</ul>
<p>üìñ Readings: 60-75 minutes</p>
<p>üíª Activities: 60-75 minutes</p>
<p>‚úÖ Check-ins: 4 (included in 1 assignment on Canvas)</p>
<hr>
<section id="why-write-a-function" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Why Write a Function?</h1>
<p>You might be coming into this chapter wondering, ‚ÄúWhy would I write a function?‚Äù. Especially, if thus far you‚Äôve been able to do everything with built-in functions and / or reusing your code a few times.</p>
<p>The critical motivation behind functions is the ‚Äúdon‚Äôt repeat yourself‚Äù (DRY) principle. In general, ‚Äúyou should consider writing a function whenever copied and pasted your code <strong>more than twice</strong> (i.e.&nbsp;you now have three copies of the same code)‚Äù (Wickham &amp; Grolemund, 2020).</p>
<p>One of my favorite papers, <em>Best Practices for Scientific Computing</em>, summarizes this idea in a slightly different way:</p>
<blockquote class="blockquote">
<p>Anything that is repeated in two or more places is more difficult to maintain. Every time a change or correction is made, multiple locations must be updated, which increases the chance of errors and inconsistencies. To avoid this, programmers follow the DRY Principle, which applies to both data and code.</p>
</blockquote>
<p>The DRY Principle applies at two scales: small and large. At small scales, researchers (<strong>you</strong>) should work to modularize code instead of copying and pasting. Modularizing your code helps you remember what the code is doing as a single mental chunk. This makes your code easier to understand, since there is less to remember! Another perk is that your modularized code can also be more easily re-purposed for other projects. At larger scales, it is vital that scientific programmers (<strong>you</strong>) re-use code instead of rewriting it (Wilson et al., 2014).</p>
<p>If you are interested in reading more about these ‚Äúbest practices‚Äù you can find the article here: <a href="https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.1001745" class="uri">https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.1001745</a></p>
<hr>
</section>
<section id="writing-functions" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Writing Functions</h1>
<p>üìñ <a href="https://r4ds.had.co.nz/functions.html">Recommended Reading: <em>R4DS</em> ‚Äì Functions</a></p>
<p>‚ñ∂Ô∏è <a href="http://somup.com/crh6eXFmMK">Recommended Video: Why write a function? ‚Äì 5 minutes</a></p>
<p>‚ñ∂Ô∏è <a href="http://somup.com/crh6euFmNj">Recommended Video: Components of a function ‚Äì 10 minutes</a></p>
<!-- ‚ñ∂Ô∏è [Recommended Video: The gritty details of function arguments -- 12 minutes](link) -->
<!-- ‚ñ∂Ô∏è [Recommended Video: Do you need a `return()` statement? -- 9 minutes](link) -->
<p>‚ñ∂Ô∏è <a href="http://somup.com/crh6eBFmNK">Recommended Video: Function environments ‚Äì 6 minutes</a></p>
<p>üíª <a href="https://rstudio.cloud/learn/primers/6">Required Tutorial: RStudio Primer ‚Äì Writing Functions</a></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>I <strong>highly recommend</strong> you work through <em>every</em> tutorial except Loops!</p>
</div>
</div>
<hr>
<p>‚úÖ <strong>Check-in: Simple Functions</strong></p>
<p>Fill in the necessary code to write a function called <code>times_seven()</code>. The function should take a single argument (<code>x</code>) and multiply the input by 7.</p>
<p>This function should check that the argument is numeric.</p>
<p>This function should also excitedly announce (print) ‚ÄúI love sevens!‚Äù if the argument to the function is a 7.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>times_seven <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(___)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(___){</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(___)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(___)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>‚úÖ <strong>Check-in: Predicting Function Behavior</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>add_or_subtract <span class="ot">&lt;-</span> <span class="cf">function</span>(first_num, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">second_num =</span> <span class="dv">2</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">type =</span> <span class="st">"add"</span>) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"add"</span>) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    first_num <span class="sc">+</span> second_num</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"subtract"</span>) {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    first_num <span class="sc">-</span> second_num</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Please choose `add` or `subtract` as the type."</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question 1:</strong> For the four calls to the <code>add_or_subtract()</code> function, which of the following will be output?</p>
<ol type="i">
<li>1</li>
<li>-1</li>
<li>30</li>
<li>An error defined by the function <code>add_or_subtract</code></li>
<li>An error defined in a different function, which is called inside the <code>add_or_subtract</code> function</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_or_subtract</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="at">type =</span> <span class="st">"subtract"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">add_or_subtract</span>(<span class="st">"orange"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">add_or_subtract</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="at">type =</span> <span class="st">"multiply"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question 2:</strong></p>
<p>Consider the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>first_num <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>second_num <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">add_or_subtract</span>(first_num, <span class="at">second_num =</span> <span class="dv">4</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>result_2 <span class="ot">&lt;-</span> <span class="fu">add_or_subtract</span>(first_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In your Global Environment, what is the value of‚Ä¶</p>
<ol type="a">
<li><code>first_num</code></li>
<li><code>second_num</code></li>
<li><code>result</code></li>
<li><code>result_2</code></li>
</ol>
<hr>
<p>‚úÖ <strong>Check-in: Functions and Data Wrangling</strong></p>
<p>Write a function called <code>find_car_make()</code> that takes as input the name of a car, and returns only the ‚Äúmake‚Äù, or the company that created the car. For example, <code>find_car_make("Toyota Camry")</code> should return <code>"Toyota"</code> and <code>find_car_make("Ford Anglica")</code> should return <code>"Ford"</code>. (You can assume that the first word of a car name is always its make.)</p>
<p>Once you‚Äôve made your function, try it out on the built-in dataset <code>mtcars</code>. In these data the car information is included as rownames. Use the <code>rownames_to_column()</code>function to create a new column in the data called <code>make</code> that gives the make and model of each car.</p>
<hr>
<section id="styling-functions" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="styling-functions"><span class="header-section-number">2.1</span> Styling Functions</h2>
<p>Part of writing reproducible and shareable code is following good <strong>style guidelines</strong>. Mostly, this means choosing good object names and using white space in a consistent and clear way.</p>
<p>You should have already read the sections of the Tidyverse Style Guide relevant to piping, plotting, and naming objects. This week we are extending these style guides to functions.</p>
<p>I would <strong>highly recommend</strong> reading through the style guide for naming functions, what to do with long lines, and the use of comments. The guide can be found here: <a href="https://style.tidyverse.org/functions.html" class="uri">https://style.tidyverse.org/functions.html</a></p>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>Designing functions is somewhat subjective, but there are a few principles that apply:</p>
<ol type="1">
<li>Choose a good, descriptive <strong>names</strong>
<ul>
<li>Your function name should describe what it does, and usually involves a verb.</li>
<li>Your argument names should be simple and / or descriptive.</li>
<li>Names of variables in the body of the function should be descriptive.</li>
</ul></li>
<li>Output should be <strong>very predictable</strong>
<ul>
<li>Your function should always <em>return</em> the same object type, no matter what input it gets.</li>
<li>Your function should expect certain objects or object types as <em>input</em>, and give errors when it does not get them.</li>
<li>Your function should give errors or warnings for common mistakes.</li>
<li>Default values of arguments should only be used when there is a clear common choice.</li>
</ul></li>
<li>The body of the function should be <strong>easy to read</strong>.
<ul>
<li>Code should use <a href="https://style.tidyverse.org/">good style principles</a>.</li>
<li>There should be occasional comments to explain the purpose of the steps.</li>
<li>Complicated steps, or steps that are repeated many times, should be written into <strong>separate functions</strong> (sometimes called <em>helper functions</em>).</li>
</ul></li>
<li>Functions should be <strong>self-contained</strong>.
<ul>
<li>They should not rely on any information besides what is given as input.</li>
<li><em>(Relying on other <em>functions</em> is fine, though</em>)</li>
<li>They should not alter the Global Environment</li>
<li><em>Functions should <strong>never</strong> load or install packages!</em></li>
</ul></li>
</ol>
<hr>
<p>‚úÖ <strong>Check-in: Function Design</strong></p>
<p>Identify <strong><em>five</em></strong> major violations of design principles for the following function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ugh <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  thing <span class="ot">&lt;-</span> dataset<span class="sc">%&gt;%</span><span class="fu">group_by</span>(Species)<span class="sc">%&gt;%</span><span class="fu">summarize</span>(<span class="at">newvar =</span> <span class="fu">mean</span>(Sepal.Length))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(thing)<span class="sc">+</span><span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> newvar))<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Sepal Lengths"</span>)}</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ugh</span>(iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>