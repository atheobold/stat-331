---
title: "Data Wrangling with dplyr"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css", "slide-style.css"]
    nature:
      highlightStyle: solarized-light
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

```{r xaringan-themer, include=FALSE}
library(xaringanthemer)
library(xaringan)
library(showtext)
library(fontawesome)
library(tidyverse)
library(flair)
library(palmerpenguins)

style_duo_accent(
  primary_color      = "#0F4C81", # pantone classic blue
  secondary_color    = "#B6CADA", # pantone baby blue
  header_font_google = google_font("Raleway"),
  text_font_google   = google_font("Raleway", "300", "300i"),
  code_font_google   = google_font("Source Code Pro"),
  text_font_size     = "30px"
)
```


class: center, middle, invert

# Cleaning and transforming data

<img src="https://d33wubrfki0l68.cloudfront.net/071952491ec4a6a532a3f70ecfa2507af4d341f9/c167c/images/hex-dplyr.png" width=300>


---
class: center, middle, inverse

# Prerequisite:  The Pipe  `%>%`

---
# Prerequisite: The Pipe

* Part of the `magrittr` package (installs with the tidyverse)

---

```{r, echo=FALSE, out.width = '70%', fig.align = "center"}
knitr::include_graphics(here::here("Images", "other", "ceci_pipe.jpeg"))
```

---
```{r, echo=FALSE, out.width = '50%', fig.align = "center"}
knitr::include_graphics(here::here("Images", "other", "magrittr_hex.png"))
```

---
# Prerequisite: The Pipe

* Part of the `magrittr` package (installs with the tidyverse)

--

* Idea:  The **data** is the primary object, so it should come first in your code.

--

* Idea:  Code should read **like a sentence**

--

```{r, echo=FALSE, fig.align = "center"}
knitr::include_graphics(here::here("Images", "other", "diagram_sentence.jpg"))
```


---
# The Pipe

```{r, eval = FALSE}
dr_bodwin %>%
  do_a_dance()
```
--

```{r, eval = FALSE}
dr_bodwin %>%
  put_on("cool hat") %>%
  do_a_dance(type = "macarena")
```

---

```{r pipe, echo=FALSE, out.width = "30%", fig.align = "center"}
knitr::include_graphics(here::here("Images", "silly_gifs", "pipe.png"))
```

---

# The Pipe

```{r, echo = FALSE}
decorate('penguins %>% summary()', eval = FALSE) %>% 
  flair("%>%") %>% 
  flair_funs(color = "teal")
```

is the same as

```{r, echo = FALSE}
decorate('summary(penguins)', eval = FALSE) %>% 
  flair_funs(color = "teal")
```

---
# The Pipe

What do you think the following will do?

```{r, eval = FALSE}
penguins %>%
  filter(species == "Adelie") %>%
  arrange(body_mass_g)
```

---
# The Pipe

What do you think the following will do?

```{r}
penguins %>%
  filter(species == "Adelie") %>%
  arrange(body_mass_g)
```

---
# Today's Data: Cereal

* Download `Practice.Rmd` from the class website.

* Run the first two chunks to load up the `cereal` dataset.

* Get a feel for the data - what does it contain?


*(This is not graded or turned in - it is just for you to follow along with lecture.)*


---

# Summarizing

```{r, echo = FALSE}
decorate('
penguins %>%
  summary()
  ') %>% flair("y(")
```

---
# Cleaning

Oh no!  There was one row of the dataset with missing values.

--

There is no magic answer for how to handle missing values; one solution is to simply drop them from the data.

*Consider - why might this sometimes be a bad idea?*

--

```{r}
penguins <- 
  penguins %>%
  drop_na()

penguins %>% summary()
  
```


---
# Summarizing specifics

```{r, echo = FALSE}
decorate('
penguins %>%
  summarize(mean_mass = mean(body_mass_g))
  ') %>% 
  flair("ize(") %>% 
  flair("mean", color = "teal") %>%
  flair("body_mass_g", color = "cornflowerblue")
```

--

* What are the **required** arguments of `summarize`?  

* Are there any optional arguments?

---

# Many variables?  Many summary statistics?
## No problemo

```{r, echo = FALSE}
decorate('
penguins %>%
  summarize(across(c(body_mass_g, flipper_length_mm),
            list(mean, median)))
  ') %>% 
  flair("across") %>%
  flair_rx("(mean)|(median)", color = "teal") %>%
  flair_rx("(body_mass_g)|(flipper_length_mm)", color = "cornflowerblue") %>%
  flair_rx("list", color = "darkred")
```
---
class: center, middle, inverse

# Your Turn!

---
class: center, middle
# In `Practice.Rmd`, find the following:

* Mean, Median, and standard deviation of the sugar content of cereals

* Total calories if I ate one serving of every single cereal in the dataset.

---
# Making new variables

Verb: `mutate()`

The dataset gets *mutated* to include a new variable.

```{r, echo = FALSE}
decorate('
penguins %>%
  mutate(
    bill_size = bill_length_mm * bill_depth_mm
  ) %>%
  summary()
  ') %>%
  flair("mutate") %>%
  flair("bill_size", color = "teal")
```

---

Cool, let's look at our new variable!

```{r, error = TRUE}
penguins %>%
  summarize(mean_bill = sd(bill_size))
```

--

OH NO!

**What happened here?**

---

class: center, middle

# We calculated a new variable, but didn't save our changes.

---

```{r, echo = FALSE}
decorate('
penguins <- penguins %>%
          mutate(
            bill_size = bill_length_mm * bill_depth_mm
          )
          
penguins %>%
  summarize(mean_bill = sd(bill_size))
') %>% 
  flair("penguins <- ")


```

---
# Ordering

Verb: `arrange()`

We **arrange** the dataset in order of a particular variable.

```{r}
penguins %>% 
  arrange(body_mass_g)
```

---

## Related: `top_n`

```{r}
penguins %>%
  top_n(3, body_mass_g)
```

---

# Quick check in!

Remember,

```{r, eval = FALSE}
penguins %>%
  top_n(3, body_mass_g)
```

is the same as

```{r, eval = FALSE}
top_n(penguins, 3, body_mass_g)
```

or

```{r, eval = FALSE}
top_n(x = penguins, n = 3, wt = body_mass_g)
```

---

# Selecting

Verb: `select()`

We **select** which variables we would like to remain in the dataset.

```{r}
penguins %>%
  select(species, body_mass_g) %>%
  arrange(body_mass_g)
```

---

# Filtering

Verb: `filter()`

We **filter** to the rows (observations) we would like to keep in the dataset.

```{r, eval = FALSE}
penguins_new %>%
  select(species, body_mass_g) %>%
  filter(species == "Adelie") %>%
  arrange(body_mass_g)
```

---

# Plotting: The pipe is your friend

Want a histogram of body mass for just *Adelie* species penguins?  Pipe it through `filter()` first!

```{r, message = FALSE, fig.height=4}
penguins %>%
  filter(species == "Adelie") %>%
  ggplot(aes(x = body_mass_g)) +
    geom_histogram(bins = 20)
```

---
class: center, middle, inverse

# Your Turn!

