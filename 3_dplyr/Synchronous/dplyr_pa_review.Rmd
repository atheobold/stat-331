---
title: "Recap of Data Wrangling with dplyr"
date: "October 4, 2022"
author: "Dr. Allison Theobold"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css", "slide-style.css"]
    nature:
      highlightStyle: solarized-light
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
---


```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 8, fig.height = 6}
knitr::opts_chunk$set(message = FALSE, 
                      warning = FALSE, 
                      fig.align = "center")

library(xaringanthemer)
library(xaringan)
library(tidyverse)
library(flair)
library(ggridges)
library(gridExtra)
library(randomNames)


style_duo_accent(
  primary_color      = "#0F4C81", # pantone classic blue
  secondary_color    = "#B6CADA", # pantone baby blue
  header_font_google = google_font("Raleway"),
  text_font_google   = google_font("Raleway", "300", "300i"),
  code_font_google   = google_font("Source Code Pro"),
  text_font_size     = "30px"
)
```

class: inverse, center, middle

.large[
> Programs must be written for people to read, and only incidentally for 
> machines to execute.
>
> â€” Hal Abelson
]

---

class: center 

.larger[A Vignette]

--

`subset()`

> Return subsets of vectors, matrices or data frames which
> meet conditions.

--

- `subset` argument states how the **rows** of the dataframe should be filtered

```{r, eval = FALSE}
subset(surveys, species_id == "DS")
```

--

- `select` argument states what **columns** should be selected from the
dataframe

```{r, eval = FALSE}
subset(surveys, species_id == "DS", select = c(weight, hindfoot_length))
```

---

class: inverse, center, middle

.huge[We want functions that accomplish **one** task!]

---

class: inverse, center, middle

.huge[We want functions with **intuitive** names!]

<!-- the tidyverse is fundamentally human centred -->

---

<center>
.larger[Data Wrangling Verbs]
</center>

.pull-left[
</br>

```{r, echo = FALSE, out.height = "70%", out.width = "70%"}
knitr::include_graphics("images/dplyr_hex.jpeg")
```
]

.pull-right[
<center>
</br>
</br> 

`filter()`

`select()`

`mutate()`

`summarize()`

`arrange()`

`group_by()`

]

---

.larger[Brainstorm definitions for each verb]

.pull-left-narrow[
- `select()`

- `filter()`

- `mutate()`

- `summarize()`

- `arrange()`

- `group_by()`
]

--

.pull-right-wide[

- selects **columns** from a dataset

- filters **rows** from a dataset

- modifies the **variables** (columns) in a dataset

- creates summary statistics based on **variables** in a dataset

- organizes a dataset based on values of a **variable**

- creates groups from a **variable** in a dataset
]

---

.bitlarger[Preview Activity Review]

Suppose we would like to study how the ratio of penguin body mass to flipper
size differs across the species. Arrange the following steps into an order that 
accomplishes this goal (assuming the steps are connected with a `%>%` or a `|>`
).

`arrange(med_mass_flipper_ratio)`

`group_by(species)`

`penguins`

`summarize(med_mass_flipper_ratio = median(mass_flipper_ratio))`

`mutate(mass_flipper_ratio = body_mass_g / flipper_length_mm))`

---

class: center

.larger[Try it out]

.large[You have data on each Cal Poly student for the 2020-2021 academic year.
You are tasked with reporting how the number of CR/NC courses students take
differs based on department.]

</br>

__What data wrangling operations would you use?__

__What order would you use to accomplish this goal?__

---

class: center

```{r, echo = FALSE}
students <- tibble(name = randomNames(n = 10), 
                   department = c(rep("Business", 3), 
                                  rep("Liberal Studies", 2),
                                  "Chemistry",
                                  rep("Biology", 2), 
                                  rep("Political Science", 2)
                                  ), 
                   CRNC_f20 = rbinom(10, size = 5, prob = 0.2),
                   CRNC_w21 = rbinom(10, size = 5, prob = 0.2),
                   CRNC_s21 = rbinom(10, size = 5, prob = 0.2)
                   )

knitr::kable(slice_sample(students, n = 10)) %>% 
  kableExtra::kable_styling()
```

.large[**Want**: Department totals for number of CR / NC courses]

---

class: center, middle

.large[Step 1: Get totals for each student]

```{r name-totals, echo = FALSE, eval = FALSE}
students %>% 
  group_by(name) %>% 
  mutate(total = sum(CRNC_f20, CRNC_w21, CRNC_s21)
         ) 

```

```{r, echo = FALSE}
decorate_chunk("name-totals", eval = TRUE) %>% 
  flair(pattern = "group_by(name)", color = "green")
```

---

class: center, middle

.large[Step 2: Get department totals]

```{r dept-totals, echo = FALSE, eval = FALSE}
students %>% 
  group_by(name) %>% 
  mutate(total = sum(CRNC_f20, CRNC_w21, CRNC_s21)
         ) %>% 
  group_by(department) %>% 
  summarize(final_total = sum(total)
            )
```

```{r, echo = FALSE}
decorate_chunk("dept-totals", eval = TRUE) %>% 
  flair(pattern = "group_by(department)", color = "blue")
```

---

class: center, middle

.large[Step 3: Arrange the totals]

```{r arrange, echo = FALSE, eval = FALSE}
students %>% 
  group_by(name) %>% 
  mutate(total = sum(CRNC_f20, CRNC_w21, CRNC_s21)
         ) %>% 
  group_by(department) %>% 
  summarize(final_total = sum(total)
            ) %>% 
  arrange(desc(final_total))
```

```{r, echo = FALSE}
decorate_chunk("arrange", eval = TRUE) %>% 
  flair(pattern = "arrange", color = "turquoise")
```

---

class: middle

.larger[Getting Specific]

Often you are interested in **one** specific summary statistic!

.pull-left[
```{r}
students %>% 
  group_by(department) %>% 
  count() 
```
]

--

.pull-right[
```{r}
students %>% 
  group_by(department) %>% 
  count() %>% 
  filter(department == "Political Science")
```
]

---

class: middle

.larger[A Handy Tool]

`pull()` 

- Extracts entries from dataframes

```{r}
students %>% 
  group_by(department) %>% 
  count() %>% 
  filter(department == "Political Science") %>% 
  pull()
```

---

class: inverse, middle, center

.huge[Your Turn: PA Exploration]
