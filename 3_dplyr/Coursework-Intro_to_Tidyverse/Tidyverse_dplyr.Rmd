---
title: "The tidyverse and dplyr"
author: ""
output:
  prettydoc::html_pretty:
    theme: tactile
    highlight: github
    css: styles.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
### change this if icons local
```

```{r, include = FALSE}
library(tidyverse)
library(flair)
library(palmerpenguins)
```

In this lesson, you'll learn how to wrangle data using the **dplyr** package in 
the *tidyverse*

When you are finished with the readings and videos, you should be able to...

* Describe to someone what the *tidyverse* is

* Use the five main dplyr verbs:

  * `filter()`
  
  * `arrange()`
  
  * `select()`
  
  * `mutate()`
  
  * `summarize()`

* Use `group_by()` to perform groupwise operations

* Use the pipe operator (`%>%`) to chain together data wrangling operations

---

`r emo::ji("play button")` Watch Videos: 40 minutes  

`r emo::ji("book")` Readings: 0-60 minutes   

`r emo::ji("computer")` Activities: 20-30 minutes  
  
`r emo::ji("check")` Check-ins: 1

---

## What is the Tidyverse?

`r emo::ji("play button")` [Required Video: Introduction to the Tidyverse](https://www.youtube.com/embed/JrnjWii18L8)


`r emo::ji("play button")` [Optional Video: The beginning of the word 'tidyverse'](https://channel9.msdn.com/Events/useR-international-R-User-conference/useR2016/Towards-a-grammar-of-interactive-graphics)


---

## Wrangling data with dplyr

`r emo::ji("book")` [Required Reading: Tibbles](https://r4ds.had.co.nz/tibbles.html)

`r emo::ji("play button")` [Required Video: dplyr](https://www.youtube.com/embed/p1NVeYm_DvG0)

`r emo::ji("paper")` [Link to Slides](Slides/Intro_to_Tidyverse.html)

`r emo::ji("book")` [Required Reading: Data Transformation](https://r4ds.had.co.nz/transform.html)

`r emo::ji("book")` [Optional Reading: Data Wrangling -- Section 3.1 through 3.6](https://moderndive.com/3-wrangling.html)

`r emo::ji("computer")` [Required Tutorial: Practice with dplyr](https://rstudio.cloud/learn/primers/2)

---

`r emo::ji("check")` Check-in: 


**Question 1:**  Suppose we would like to study how the ratio of penguin body
mass to flipper size differs across the species.  Rearrange the following steps
into an order that accomplishes this goal (assuming the steps are connected with
a `%>%`).

```{r, include = FALSE}
penguins %>%
  mutate(
    mass_flipper_ratio = body_mass_g/flipper_length_mm
  ) %>%
  group_by(species) %>%
  summarize(
    avg_mass_flipper_ratio = median(mass_flipper_ratio)
  ) %>%
  arrange(avg_mass_flipper_ratio)

#cebda
```

```{r, eval = FALSE}

# a
arrange(avg_mass_flipper_ratioo)


# b
group_by(species)

# c
penguins 
  

# d
summarize(
  avg_mass_flipper_ratioo = median(mass_flipper_ratio)
)
  
# e
mutate(
  mass_flipper_ratio = body_mass_g/flipper_length_mm
)
  
```

**Question 2:** 

Consider the base R code below.


```{r, eval = FALSE}
mean(penguins[penguins$species == "Adelie", "body_mass_g"])
```

<!-- Mean of Adelie specied body mass!  -->

For each of the following `dplyr` pipelines, indicate if it

(i) Returns the exact same thing as the (above) base R code;
(ii) Returns the correct information, but the wrong object type;
(iii) Returns incorrect information; or
(iv) Returns an error

```{r, eval = FALSE}
# a
penguins %>%
  filter("body_mass_g") %>%
  pull("Adelie") %>%
  mean()


# b
penguins %>%
  filter(species == "Adelie") %>%
  select(body_mass_g) %>%
  summarize(mean(body_mass_g))


# c
penguins %>%
  pull(body_mass_g) %>%
  filter(species == "Adelie") %>%
  mean()

# d
penguins %>%
  filter(species == "Adelie") %>%
  select(body_mass_g) %>%
  mean()

# e
penguins %>%
  filter(species == "Adelie") %>%
  pull(body_mass_g) %>%
  mean()

# f
penguins %>%
  select(species == "Adelie") %>%
  filter(body_mass_g) %>%
  summarize(mean(body_mass_g))
```

<!-- A = incorrect filter statement -> Error -->

<!-- B = correct information but a tibble not a vector -->

<!-- C = cannot filter when species is gone -> Error  -->

<!-- D = doesn't return a correct value, no input to mean()  -->

<!-- E = same as base R, vector output -->

<!-- F = flipped filter and select -> Error  -->

---

## Walkthrough of `cereals` activity

`r emo::ji("play button")` [Optional Video: Live coding of cereals dataset](https://www.youtube.com/watch?v=CgQELANvAZ8)

