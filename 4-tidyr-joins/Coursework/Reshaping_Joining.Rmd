---
title: "Reshaping and Joining Data Frames"
author: ""
output:
  prettydoc::html_pretty:
    theme: tactile
    highlight: github
    css: styles.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
### change this if icons local
```

```{r, include = FALSE}
library(tidyverse)
library(flair)
```


In this lesson, you will learn to:

* **Reshape** your dataset by pivoting *longer* or *wider*

* Use **mutating joins** and **filtering joins** to combine different datasets with related information.

* Understand the importance of nicely formatted code and how to adhere to 
style "guidelines"


---

`r emo::ji("play button")` Watch Videos: 60 minutes  

`r emo::ji("book")` Readings: 20-60 minutes   

`r emo::ji("computer")` Activities: 60 minutes  
  
`r emo::ji("check")` Check-ins: 4


---

## Code Style 

---

Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread.

In this section, you will explore the *tidyverse Style Guide*, an example of a
guideline for how you should format R code. Every style guide is opinionated. 
Some guidelines genuinely do make code easier to read, while others may seem 
more arbitrary. The most important feature about style guides is consistency. 
This consistency benefits you, since you have to make fewer decisions, and
also the people reading your code! 

The document is lengthy (since it covers **any** code you could write in R), so
we will focus on the sections that address aspects of coding in R we have 
already learned. We will use other sections as we build more skills!

[The tidyverse style guide -- Syntax](https://style.tidyverse.org/syntax.html) 

- __Focus on:__ Object names, Spacing, Function calls, Long lines, Assignment, 
Data, and Comments

[The tidyverse style guide -- Pipes](https://style.tidyverse.org/pipes.html)

- This is all important! 

[The tidyverse style guide -- ggplot2](https://style.tidyverse.org/ggplot2.html)

- This is all important! 

---

`r emo::ji("check")` Check-in: Code Style

**Question 1:** Based on the tidyverse style guide, where should whitespace (blank spaces) go? 

- Before and after every `+` sign

- Before and after every `%>%`

- Before and after every athematic operator (`+`, `-`, `*`, `/`)

- After every comma

- Before every comma

**Question 3:** How many characters per line should you strive to have in your 
R code (and RMarkdown files)?

**Question 2:** Which of the following are **bad** object names?

- `data`

- `cereals_data`

- `cereals.data`

- `cerealsData`

- `cerealsdata`

- `cereals_data1`

- `cereals_data_clean`


---

## Reshaping Data

---

### Tidy Data and Reshaping

`r emo::ji("book")` [Required Reading: *R4DS* 12.1-12.3 (Tidy Data)](https://r4ds.had.co.nz/tidy-data.html)

`r emo::ji("play button")` [Required Video: Pivoting Longer]()

`r emo::ji("play button")` [Required Video: Pivoting Wider]()

`r emo::ji("book")` [Optional Reading: *R4DS* 12.4-12.5 (Separate/Unite and Missing Values)](https://r4ds.had.co.nz/tidy-data.html) -- A few more tricks for data cleaning / wrangling, if you're interested!


---

`r emo::ji("check")` Check-in: Pivoting

- Download the `cereals.csv` data here: [https://app.box.com/s/zcr1fijnwxs27nvtxn4p38p3sgtxl4bt](https://app.box.com/s/zcr1fijnwxs27nvtxn4p38p3sgtxl4bt)

**Question 1:** Create a new dataset called `cereals_long`, that has three
columns:

* The `name` of the cereal

* A column called `Nutrient` with values `"protein"`, `"fat"`, or `"fiber"`.

* A column called `Amount` with the corresponding amount of the nutrient.

---

## Joining data

---

`r emo::ji("book")` [Required Reading: *R4DS* Chapter 13 (Relational Data)](https://r4ds.had.co.nz/relational-data.html)

`r emo::ji("book")` [Required Reading: Mutating Joins](https://www.garrickadenbuie.com/project/tidyexplain/)

`r emo::ji("play button")` [Required Video: Left Joins]()

`r emo::ji("play button")` [Required Video: Right Joins]()

`r emo::ji("play button")` [Required Video: Full Joins]()

`r emo::ji("play button")` [Required Video: Inner Joins]()


---

`r emo::ji("check")` Check-in: Practice with Joins

The following code creates three datasets:

```{r}
data1 <- data.frame(
  professor = 
    c("Bodwin", "Glanz", "Carlton", "Sun", "Theobold"),
  undergrad_school = 
    c("Harvard", "Cal Poly", "Cal Poly", "Harvard",
      "Colorado Mesa University"),
  grad_school = 
    c("UNC", "Boston University", "UCLA", "Stanford",
      "Montana State")
)

data2 <- data.frame(
  professor = c("Bodwin", "Glanz", "Carlton",
                "Theobold"),
  Stat_331 = c(TRUE, TRUE, TRUE, TRUE),
  Stat_330 = c(FALSE, TRUE, TRUE, FALSE),
  Stat_431 = c(TRUE, TRUE, FALSE, TRUE)
)

data3 <- data.frame(
  course = c("Stat_331", "Stat_330", "Stat_431"),
  num_sections = c(8, 3, 1)
)

```

Here is what they look like once created:

```{r, echo = FALSE}
data1

data2

data3
```

These datasets contain information about four Cal Poly professors, their
educational history, the classes they are able to teach, and the number of
sections of each class that need to be assigned.

We'd like to use all three datasets to figure out the best assignment of courses.

**Question 1: Warm-up** 

a) Combine datasets 1 and 2 to make this:

```{r, echo = FALSE, message = FALSE}

data1 %>% full_join(data2)

```

b) Combine datasets 1 and 2 to make this:

```{r, echo = FALSE, message = FALSE}

data1 %>% right_join(data2)

```

c) Combine datasets 2 and 3 to make this:

```{r, echo = FALSE, message = FALSE}
data2 %>%
  pivot_longer(Stat_331:Stat_431, 
               names_to = "course",
               values_to = "can_teach") %>%
  full_join(data3)
```


**Question 2: Solve the puzzle**

We would like to assign teachers for next year, with the following guidelines:

1. Each professor should be given 4 sections.

2. At least half of all 331 sections should be taught by non-Cal Poly graduates.

3. More than half of all 330 sections should be taught by UCLA graduates.

4. Each professor should teach at least 2 different classes.

Combine the three datasets into a single data frame that helps you find
the answer to the question:

*How many sections of Stat 331 will Dr. Bodwin teach?*

